

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Basic Image Registration with Twocan &mdash; Twocan 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Twocan
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Core Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="01_basic_registration.html">Basic registration with Twocan defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_basic_registration.html#apply-the-transformation">Apply the transformation!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Twocan</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">1. Basic Image Registration with Twocan</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/03_custom_optimization.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="basic-image-registration-with-twocan">
<h1>1. Basic Image Registration with Twocan<a class="headerlink" href="#basic-image-registration-with-twocan" title="Link to this heading"></a></h1>
<p>This notebook demonstrates a basic image registration workflow using the <code class="docutils literal notranslate"><span class="pre">Twocan</span></code> library. We will register an example same-slide IF and IMC image using the default utilities:</p>
<ol class="arabic simple">
<li><p>Preprocessors <code class="docutils literal notranslate"><span class="pre">IFprocessor</span></code> and <code class="docutils literal notranslate"><span class="pre">IMCprocessor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RegEstimator</span></code> to get the transformation matrix</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">registation_trial</span></code> and <code class="docutils literal notranslate"><span class="pre">iou_corr_single_objective</span></code> which are designed for IF/IMC registration</p></li>
</ol>
<p>Custom functions can be provided in place of these defaults to register pairs of images of different technologies or experimental set ups (eg. serial sections)</p>
<p>We will set the IF as the “fixed” or target image, and IMC as the “moving” or soruce image.</p>
</section>
<section id="a-note-on-data-formats">
<h1>1. A note on data formats<a class="headerlink" href="#a-note-on-data-formats" title="Link to this heading"></a></h1>
</section>
<section id="using-callbacks-other-optuna-features">
<h1>1. Using callbacks (&amp; other Optuna features)<a class="headerlink" href="#using-callbacks-other-optuna-features" title="Link to this heading"></a></h1>
</section>
<section id="custom-trial-objectives">
<h1>1. Custom trial &amp; objectives<a class="headerlink" href="#custom-trial-objectives" title="Link to this heading"></a></h1>
</section>
<section id="picking-registration-channels">
<h1>1. Picking registration channels<a class="headerlink" href="#picking-registration-channels" title="Link to this heading"></a></h1>
</section>
<section id="rescaling-for-mismatched-resolution">
<h1>1. Rescaling for mismatched resolution<a class="headerlink" href="#rescaling-for-mismatched-resolution" title="Link to this heading"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">twocan</span><span class="w"> </span><span class="kn">import</span> <span class="n">IFProcessor</span><span class="p">,</span> <span class="n">IMCProcessor</span><span class="p">,</span> <span class="n">RegEstimator</span><span class="p">,</span> <span class="n">registration_trial</span><span class="p">,</span> <span class="n">iou_corr_single_objective</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">twocan.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">pick_best_registration</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">twocan.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_registration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spatialdata</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpatialData</span><span class="p">,</span> <span class="n">read_zarr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">optuna</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/harrigan/.conda/envs/twocan/lib/python3.9/site-packages/pyproj/__init__.py:95: UserWarning: pyproj unable to set database path.
  _pyproj_global_context_initialize()
/home/harrigan/.conda/envs/twocan/lib/python3.9/site-packages/numba/core/decorators.py:246: RuntimeWarning: nopython is set for njit and is ignored
  warnings.warn(&#39;nopython is set for njit and is ignored&#39;, RuntimeWarning)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;/home/harrigan/repair-quant/twocan_repo/notebooks&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="load-data">
<h2>Load data<a class="headerlink" href="#load-data" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdata</span> <span class="o">=</span> <span class="n">read_zarr</span><span class="p">(</span><span class="s1">&#39;examples/01_imc_if/data/cell-line-0028-bd18455.zarr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Both the IF and IMC image are saved into this zarr, with their channel names. The IMC image has a transformation matrix in the ‘aligned’ coordinate system, and we will show how this matrix was found using Twocan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdata</span><span class="p">[</span><span class="s1">&#39;IF&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;image&#x27; (c: 3, y: 512, x: 512)&gt; Size: 2MB
dask.array&lt;from-zarr, shape=(3, 512, 512), dtype=uint16, chunksize=(3, 512, 512), chunktype=numpy.ndarray&gt;
Coordinates:
  * c        (c) &lt;U4 48B &#x27;DAPI&#x27; &#x27;GFP&#x27; &#x27;RFP&#x27;
  * y        (y) float64 4kB 0.5 1.5 2.5 3.5 4.5 ... 508.5 509.5 510.5 511.5
  * x        (x) float64 4kB 0.5 1.5 2.5 3.5 4.5 ... 508.5 509.5 510.5 511.5
Attributes:
    transform:  {&#x27;global&#x27;: Identity }</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'image'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>c</span>: 3</li><li><span class='xr-has-index'>y</span>: 512</li><li><span class='xr-has-index'>x</span>: 512</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-306299f6-8ed8-4c5d-a2cb-8341e15ab09e' class='xr-array-in' type='checkbox' checked><label for='section-306299f6-8ed8-4c5d-a2cb-8341e15ab09e' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(3, 512, 512), meta=np.ndarray&gt;</span></div><div class='xr-array-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 1.50 MiB </td>
                        <td> 1.50 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (3, 512, 512) </td>
                        <td> (3, 512, 512) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> uint16 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="194" height="184" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="10" y1="120" x2="24" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="120" style="stroke-width:2" />
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 24.9485979497544,14.948597949754403 24.9485979497544,134.9485979497544 10.0,120.0" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="24" y2="14" style="stroke-width:2" />
  <line x1="130" y1="0" x2="144" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 144.9485979497544,14.948597949754403 24.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="24" y1="14" x2="144" y2="14" style="stroke-width:2" />
  <line x1="24" y1="134" x2="144" y2="134" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="24" y1="14" x2="24" y2="134" style="stroke-width:2" />
  <line x1="144" y1="14" x2="144" y2="134" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="24.9485979497544,14.948597949754403 144.9485979497544,14.948597949754403 144.9485979497544,134.9485979497544 24.9485979497544,134.9485979497544" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="84.948598" y="154.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" >512</text>
  <text x="164.948598" y="74.948598" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,164.948598,74.948598)">512</text>
  <text x="7.474299" y="147.474299" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,7.474299,147.474299)">3</text>
</svg>
        </td>
    </tr>
</table></div></div></li><li class='xr-section-item'><input id='section-25b424fb-97e5-490c-8261-ffe07cb55ea0' class='xr-section-summary-in' type='checkbox'  checked><label for='section-25b424fb-97e5-490c-8261-ffe07cb55ea0' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>c</span></div><div class='xr-var-dims'>(c)</div><div class='xr-var-dtype'>&lt;U4</div><div class='xr-var-preview xr-preview'>&#x27;DAPI&#x27; &#x27;GFP&#x27; &#x27;RFP&#x27;</div><input id='attrs-781488b0-3650-4123-ae7c-a2532fb2b2e8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-781488b0-3650-4123-ae7c-a2532fb2b2e8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ff3b849e-9a0d-4ace-a939-a13666d8b869' class='xr-var-data-in' type='checkbox'><label for='data-ff3b849e-9a0d-4ace-a939-a13666d8b869' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;DAPI&#x27;, &#x27;GFP&#x27;, &#x27;RFP&#x27;], dtype=&#x27;&lt;U4&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5 1.5 2.5 ... 509.5 510.5 511.5</div><input id='attrs-fb8f46f1-9a6a-4640-96a8-ebdfd2681f7e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fb8f46f1-9a6a-4640-96a8-ebdfd2681f7e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a6217e21-78b0-4be6-a03b-95a4ffe96cbd' class='xr-var-data-in' type='checkbox'><label for='data-a6217e21-78b0-4be6-a03b-95a4ffe96cbd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([5.000e-01, 1.500e+00, 2.500e+00, ..., 5.095e+02, 5.105e+02, 5.115e+02])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5 1.5 2.5 ... 509.5 510.5 511.5</div><input id='attrs-6115970f-d78c-499f-9cfa-7e44d71100bf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6115970f-d78c-499f-9cfa-7e44d71100bf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-791162a0-207a-47ad-9397-1968c87d2f79' class='xr-var-data-in' type='checkbox'><label for='data-791162a0-207a-47ad-9397-1968c87d2f79' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([5.000e-01, 1.500e+00, 2.500e+00, ..., 5.095e+02, 5.105e+02, 5.115e+02])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-91faa753-6b25-4df3-abc1-85cb2e0a6c31' class='xr-section-summary-in' type='checkbox'  ><label for='section-91faa753-6b25-4df3-abc1-85cb2e0a6c31' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>c</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-7da24bd8-e08a-4840-a8ff-39ec0c2ddfcf' class='xr-index-data-in' type='checkbox'/><label for='index-7da24bd8-e08a-4840-a8ff-39ec0c2ddfcf' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;DAPI&#x27;, &#x27;GFP&#x27;, &#x27;RFP&#x27;], dtype=&#x27;object&#x27;, name=&#x27;c&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-5c3ca662-a8c5-46cc-b935-cf62268a0375' class='xr-index-data-in' type='checkbox'/><label for='index-5c3ca662-a8c5-46cc-b935-cf62268a0375' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  0.5,   1.5,   2.5,   3.5,   4.5,   5.5,   6.5,   7.5,   8.5,   9.5,
       ...
       502.5, 503.5, 504.5, 505.5, 506.5, 507.5, 508.5, 509.5, 510.5, 511.5],
      dtype=&#x27;float64&#x27;, name=&#x27;y&#x27;, length=512))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-b4fcc36e-8756-4b28-8c16-1080bc15b9b2' class='xr-index-data-in' type='checkbox'/><label for='index-b4fcc36e-8756-4b28-8c16-1080bc15b9b2' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  0.5,   1.5,   2.5,   3.5,   4.5,   5.5,   6.5,   7.5,   8.5,   9.5,
       ...
       502.5, 503.5, 504.5, 505.5, 506.5, 507.5, 508.5, 509.5, 510.5, 511.5],
      dtype=&#x27;float64&#x27;, name=&#x27;x&#x27;, length=512))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a550f005-4e70-40d4-8365-749219beba0c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a550f005-4e70-40d4-8365-749219beba0c' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>transform :</span></dt><dd>{&#x27;global&#x27;: Identity }</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdata</span><span class="p">[</span><span class="s1">&#39;IMC&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
html[data-theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;image&#x27; (c: 24, y: 944, x: 953)&gt; Size: 86MB
dask.array&lt;from-zarr, shape=(24, 944, 953), dtype=float32, chunksize=(24, 944, 953), chunktype=numpy.ndarray&gt;
Coordinates:
  * c        (c) &lt;U12 1kB &#x27;-&#x27; &#x27;pHH3_S28&#x27; &#x27;-&#x27; &#x27;-&#x27; ... &#x27;PCNA&#x27; &#x27;DNA1&#x27; &#x27;DNA2&#x27; &#x27;-&#x27;
  * y        (y) float64 8kB 0.5 1.5 2.5 3.5 4.5 ... 940.5 941.5 942.5 943.5
  * x        (x) float64 8kB 0.5 1.5 2.5 3.5 4.5 ... 949.5 950.5 951.5 952.5
Attributes:
    transform:  {&#x27;global&#x27;: Identity , &#x27;aligned&#x27;: Sequence \n    Identity \n  ...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'image'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>c</span>: 24</li><li><span class='xr-has-index'>y</span>: 944</li><li><span class='xr-has-index'>x</span>: 953</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-c5f4614d-9ee7-40e4-9ce2-31ae64fb148d' class='xr-array-in' type='checkbox' checked><label for='section-c5f4614d-9ee7-40e4-9ce2-31ae64fb148d' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(24, 944, 953), meta=np.ndarray&gt;</span></div><div class='xr-array-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <th> Bytes </th>
                        <td> 82.36 MiB </td>
                        <td> 82.36 MiB </td>
                    </tr>
                    
                    <tr>
                        <th> Shape </th>
                        <td> (24, 944, 953) </td>
                        <td> (24, 944, 953) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 1 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float32 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="197" height="186" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="27" y2="17" style="stroke-width:2" />
  <line x1="10" y1="118" x2="27" y2="136" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="10" y2="118" style="stroke-width:2" />
  <line x1="27" y1="17" x2="27" y2="136" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 27.855409649174852,17.855409649174852 27.855409649174852,136.72214627037107 10.0,118.86673662119622" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="10" y1="0" x2="130" y2="0" style="stroke-width:2" />
  <line x1="27" y1="17" x2="147" y2="17" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="10" y1="0" x2="27" y2="17" style="stroke-width:2" />
  <line x1="130" y1="0" x2="147" y2="17" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="10.0,0.0 130.0,0.0 147.85540964917485,17.855409649174852 27.855409649174852,17.855409649174852" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="27" y1="17" x2="147" y2="17" style="stroke-width:2" />
  <line x1="27" y1="136" x2="147" y2="136" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="27" y1="17" x2="27" y2="136" style="stroke-width:2" />
  <line x1="147" y1="17" x2="147" y2="136" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="27.855409649174852,17.855409649174852 147.85540964917485,17.855409649174852 147.85540964917485,136.72214627037107 27.855409649174852,136.72214627037107" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="87.855410" y="156.722146" font-size="1.0rem" font-weight="100" text-anchor="middle" >953</text>
  <text x="167.855410" y="77.288778" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,167.855410,77.288778)">944</text>
  <text x="8.927705" y="147.794441" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,8.927705,147.794441)">24</text>
</svg>
        </td>
    </tr>
</table></div></div></li><li class='xr-section-item'><input id='section-5ffb1283-00b1-436e-918e-001bfe9ad116' class='xr-section-summary-in' type='checkbox'  checked><label for='section-5ffb1283-00b1-436e-918e-001bfe9ad116' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>c</span></div><div class='xr-var-dims'>(c)</div><div class='xr-var-dtype'>&lt;U12</div><div class='xr-var-preview xr-preview'>&#x27;-&#x27; &#x27;pHH3_S28&#x27; &#x27;-&#x27; ... &#x27;DNA2&#x27; &#x27;-&#x27;</div><input id='attrs-7b7eadf2-ed74-42a7-88b1-8821fec9f5a4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7b7eadf2-ed74-42a7-88b1-8821fec9f5a4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98c7363b-1117-462e-805e-4285c3b306d4' class='xr-var-data-in' type='checkbox'><label for='data-98c7363b-1117-462e-805e-4285c3b306d4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;-&#x27;, &#x27;pHH3_S28&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;HH3&#x27;, &#x27;p21&#x27;, &#x27;RFP&#x27;,
       &#x27;pRb_S807S811&#x27;, &#x27;GFP&#x27;, &#x27;cycB1&#x27;, &#x27;cycE1&#x27;, &#x27;bActin&#x27;, &#x27;pS6_S235S236&#x27;,
       &#x27;pmTOR_S2448&#x27;, &#x27;cCASP3&#x27;, &#x27;Ki67&#x27;, &#x27;cycD1&#x27;, &#x27;PCNA&#x27;, &#x27;DNA1&#x27;, &#x27;DNA2&#x27;, &#x27;-&#x27;],
      dtype=&#x27;&lt;U12&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5 1.5 2.5 ... 941.5 942.5 943.5</div><input id='attrs-fecf897c-c633-46d4-8e1d-568052c783e0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fecf897c-c633-46d4-8e1d-568052c783e0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-33911890-efa1-49bc-a935-d64b54a5cc08' class='xr-var-data-in' type='checkbox'><label for='data-33911890-efa1-49bc-a935-d64b54a5cc08' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([5.000e-01, 1.500e+00, 2.500e+00, ..., 9.415e+02, 9.425e+02, 9.435e+02])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5 1.5 2.5 ... 950.5 951.5 952.5</div><input id='attrs-64b8807d-f128-468f-8d26-3665ff39f6e2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-64b8807d-f128-468f-8d26-3665ff39f6e2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ec10d034-6be4-4511-afe4-5f6004680f52' class='xr-var-data-in' type='checkbox'><label for='data-ec10d034-6be4-4511-afe4-5f6004680f52' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([5.000e-01, 1.500e+00, 2.500e+00, ..., 9.505e+02, 9.515e+02, 9.525e+02])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-9a6ccfc6-f3c4-452c-9b1a-e01f2b05b8c7' class='xr-section-summary-in' type='checkbox'  ><label for='section-9a6ccfc6-f3c4-452c-9b1a-e01f2b05b8c7' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>c</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-eb03a319-535d-4c15-bba6-9e3bbe4b9328' class='xr-index-data-in' type='checkbox'/><label for='index-eb03a319-535d-4c15-bba6-9e3bbe4b9328' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;-&#x27;, &#x27;pHH3_S28&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;-&#x27;, &#x27;HH3&#x27;, &#x27;p21&#x27;, &#x27;RFP&#x27;,
       &#x27;pRb_S807S811&#x27;, &#x27;GFP&#x27;, &#x27;cycB1&#x27;, &#x27;cycE1&#x27;, &#x27;bActin&#x27;, &#x27;pS6_S235S236&#x27;,
       &#x27;pmTOR_S2448&#x27;, &#x27;cCASP3&#x27;, &#x27;Ki67&#x27;, &#x27;cycD1&#x27;, &#x27;PCNA&#x27;, &#x27;DNA1&#x27;, &#x27;DNA2&#x27;, &#x27;-&#x27;],
      dtype=&#x27;object&#x27;, name=&#x27;c&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-7562c1db-28cb-4d74-a8d8-7f8261332605' class='xr-index-data-in' type='checkbox'/><label for='index-7562c1db-28cb-4d74-a8d8-7f8261332605' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  0.5,   1.5,   2.5,   3.5,   4.5,   5.5,   6.5,   7.5,   8.5,   9.5,
       ...
       934.5, 935.5, 936.5, 937.5, 938.5, 939.5, 940.5, 941.5, 942.5, 943.5],
      dtype=&#x27;float64&#x27;, name=&#x27;y&#x27;, length=944))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-852dcc5d-e629-4c14-aec2-3767e74be86c' class='xr-index-data-in' type='checkbox'/><label for='index-852dcc5d-e629-4c14-aec2-3767e74be86c' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  0.5,   1.5,   2.5,   3.5,   4.5,   5.5,   6.5,   7.5,   8.5,   9.5,
       ...
       943.5, 944.5, 945.5, 946.5, 947.5, 948.5, 949.5, 950.5, 951.5, 952.5],
      dtype=&#x27;float64&#x27;, name=&#x27;x&#x27;, length=953))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-9a26ab10-d5b8-4997-862b-6a3ee6cf2d31' class='xr-section-summary-in' type='checkbox'  checked><label for='section-9a26ab10-d5b8-4997-862b-6a3ee6cf2d31' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>transform :</span></dt><dd>{&#x27;global&#x27;: Identity , &#x27;aligned&#x27;: Sequence 
    Identity 
    Affine (c, y, x -&gt; c, x, y)
        [1. 0. 0. 0.]
        [ 0.00000000e+00  3.10354772e-03  9.99401782e-01 -4.85164672e+01]
        [ 0.00000000e+00  9.99401782e-01 -3.10354772e-03 -4.03882442e+01]
        [0. 0. 0. 1.]}</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sdata</span><span class="o">.</span><span class="n">images</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;IF&#39;: &lt;xarray.DataArray &#39;image&#39; (c: 3, y: 512, x: 512)&gt; Size: 2MB
dask.array&lt;from-zarr, shape=(3, 512, 512), dtype=uint16, chunksize=(3, 512, 512), chunktype=numpy.ndarray&gt;
Coordinates:
  * c        (c) &lt;U4 48B &#39;DAPI&#39; &#39;GFP&#39; &#39;RFP&#39;
  * y        (y) float64 4kB 0.5 1.5 2.5 3.5 4.5 ... 508.5 509.5 510.5 511.5
  * x        (x) float64 4kB 0.5 1.5 2.5 3.5 4.5 ... 508.5 509.5 510.5 511.5
Attributes:
    transform:  {&#39;global&#39;: Identity }, &#39;IMC&#39;: &lt;xarray.DataArray &#39;image&#39; (c: 24, y: 944, x: 953)&gt; Size: 86MB
dask.array&lt;from-zarr, shape=(24, 944, 953), dtype=float32, chunksize=(24, 944, 953), chunktype=numpy.ndarray&gt;
Coordinates:
  * c        (c) &lt;U12 1kB &#39;-&#39; &#39;pHH3_S28&#39; &#39;-&#39; &#39;-&#39; ... &#39;PCNA&#39; &#39;DNA1&#39; &#39;DNA2&#39; &#39;-&#39;
  * y        (y) float64 8kB 0.5 1.5 2.5 3.5 4.5 ... 940.5 941.5 942.5 943.5
  * x        (x) float64 8kB 0.5 1.5 2.5 3.5 4.5 ... 949.5 950.5 951.5 952.5
Attributes:
    transform:  {&#39;global&#39;: Identity , &#39;aligned&#39;: Sequence \n    Identity \n  ...}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Run optimization to find the best registration parameters</span>
</pre></div>
</div>
</div>
</div>
<p>We will register using nuclear channels: DAPI and DNA1/DNA2 respectively. All channels with matching names to the list will be summed along the channel axis to create the registration image. That is: DAPI will be registered to the DNA1+DNA2 signal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registration_channels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DAPI&#39;</span><span class="p">,</span> <span class="s1">&#39;DNA1&#39;</span><span class="p">,</span> <span class="s1">&#39;DNA2&#39;</span><span class="p">]</span>
<span class="n">correlation_channels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GFP&#39;</span><span class="p">,</span> <span class="s1">&#39;RFP&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The resolution of the IF image (1.714um/px) is different from the IMC (1um/px)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="n">study_name</span><span class="o">=</span><span class="s2">&quot;example_1&quot;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">435</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[I 2025-05-29 23:10:04,287] A new study created in memory with name: example_1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">iou_corr_single_objective</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">sdata</span><span class="p">,</span> <span class="n">registration_channels</span><span class="p">,</span> <span class="n">correlation_channels</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[I 2025-05-29 23:13:54,857] Trial 74 finished with value: 0.606051768526489 and parameters: {&#39;IF_binarization_threshold&#39;: 0.023051918423522826, &#39;IF_gaussian_sigma&#39;: 0.41492083084960785, &#39;IMC_arcsinh_normalize&#39;: False, &#39;IMC_arcsinh_cofactor&#39;: 74.46447442086576, &#39;IMC_winsorization_lower_limit&#39;: 0.18333427749576028, &#39;IMC_winsorization_upper_limit&#39;: 0.0615777624518764, &#39;IMC_binarization_threshold&#39;: 0.4132098146518948, &#39;IMC_gaussian_sigma&#39;: 2.359809325254669, &#39;binarize_images&#39;: True, &#39;registration_max_features&#39;: 100000, &#39;registration_percentile&#39;: 0.9, &#39;moving_image&#39;: &#39;IMC&#39;, &#39;static_image&#39;: &#39;IF&#39;}. Best is trial 69 with value: 0.7170164860003657.
</pre></div>
</div>
</div>
</div>
</section>
<section id="pick-best-trial">
<h2>Pick best trial<a class="headerlink" href="#pick-best-trial" title="Link to this heading"></a></h2>
<p>We can checkout the parameters selected for the best trial
Twocan suggests the best trial based on the balanced score, this is not necessarily the same trial as that which maximizes the optimization objectives: this can be extracted with the optuna method <code class="docutils literal notranslate"><span class="pre">study.best_trial</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optuna_best_trial</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_trial</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optuna_best_trial</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FrozenTrial(number=69, state=TrialState.COMPLETE, values=[0.7170164860003657], datetime_start=datetime.datetime(2025, 5, 29, 23, 12, 54, 828782), datetime_complete=datetime.datetime(2025, 5, 29, 23, 12, 57, 353228), params={&#39;IF_binarization_threshold&#39;: 0.03434665503816838, &#39;IF_gaussian_sigma&#39;: 0.1625850872389713, &#39;IMC_arcsinh_normalize&#39;: False, &#39;IMC_arcsinh_cofactor&#39;: 90.71740690650462, &#39;IMC_winsorization_lower_limit&#39;: 0.19916139257481844, &#39;IMC_winsorization_upper_limit&#39;: 0.07038754802100661, &#39;IMC_binarization_threshold&#39;: 0.4135779100577611, &#39;IMC_gaussian_sigma&#39;: 1.9252828823481996, &#39;binarize_images&#39;: True, &#39;registration_max_features&#39;: 100000, &#39;registration_percentile&#39;: 0.9, &#39;moving_image&#39;: &#39;IMC&#39;, &#39;static_image&#39;: &#39;IF&#39;}, user_attrs={&#39;registration_matrix&#39;: array([[ 5.81153556e-01,  2.49409559e-03, -2.82827661e+01],
       [-2.49409559e-03,  5.81153556e-01, -2.25687258e+01]]), &#39;source_sum&#39;: 29134, &#39;target_sum&#39;: 27733, &#39;logical_and&#39;: 25600, &#39;logical_or&#39;: 31267, &#39;logical_xor&#39;: 5667, &#39;logical_iou&#39;: 0.8187545974989605, &#39;stack_image_max_corr&#39;: 0.8758872747421265, &#39;reg_image_max_corr&#39;: 0.8757404088973999, &#39;corr_image_max_corr&#39;: 0.7689441442489624, &#39;stack_cell_max_corr&#39;: 0.7797222, &#39;reg_cell_max_corr&#39;: 0.77972084, &#39;corr_cell_max_corr&#39;: 0.35944554}, system_attrs={}, intermediate_values={}, distributions={&#39;IF_binarization_threshold&#39;: FloatDistribution(high=1.0, log=False, low=0.0, step=None), &#39;IF_gaussian_sigma&#39;: FloatDistribution(high=5.0, log=False, low=0.0, step=None), &#39;IMC_arcsinh_normalize&#39;: CategoricalDistribution(choices=(True, False)), &#39;IMC_arcsinh_cofactor&#39;: FloatDistribution(high=100.0, log=False, low=1.0, step=None), &#39;IMC_winsorization_lower_limit&#39;: FloatDistribution(high=0.2, log=False, low=0.0, step=None), &#39;IMC_winsorization_upper_limit&#39;: FloatDistribution(high=0.2, log=False, low=0.0, step=None), &#39;IMC_binarization_threshold&#39;: FloatDistribution(high=1.0, log=False, low=0.0, step=None), &#39;IMC_gaussian_sigma&#39;: FloatDistribution(high=5.0, log=False, low=0.0, step=None), &#39;binarize_images&#39;: CategoricalDistribution(choices=(True,)), &#39;registration_max_features&#39;: CategoricalDistribution(choices=(100000,)), &#39;registration_percentile&#39;: CategoricalDistribution(choices=(0.9,)), &#39;moving_image&#39;: CategoricalDistribution(choices=(&#39;IMC&#39;,)), &#39;static_image&#39;: CategoricalDistribution(choices=(&#39;IF&#39;,))}, trial_id=69, value=None)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">twocan_best_trial</span> <span class="o">=</span> <span class="n">pick_best_registration</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">trials_dataframe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">twocan_best_trial</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>number                                                                                 69
value                                                                            0.717016
datetime_start                                                 2025-05-29 23:12:54.828782
datetime_complete                                              2025-05-29 23:12:57.353228
duration                                                           0 days 00:00:02.524446
params_IF_binarization_threshold                                                 0.034347
params_IF_gaussian_sigma                                                         0.162585
params_IMC_arcsinh_cofactor                                                     90.717407
params_IMC_arcsinh_normalize                                                        False
params_IMC_binarization_threshold                                                0.413578
params_IMC_gaussian_sigma                                                        1.925283
params_IMC_winsorization_lower_limit                                             0.199161
params_IMC_winsorization_upper_limit                                             0.070388
params_binarize_images                                                               True
params_moving_image                                                                   IMC
params_registration_max_features                                                 100000.0
params_registration_percentile                                                        0.9
params_static_image                                                                    IF
user_attrs_corr_cell_max_corr                                                    0.359446
user_attrs_corr_image_max_corr                                                   0.768944
user_attrs_logical_and                                                            25600.0
user_attrs_logical_iou                                                           0.818755
user_attrs_logical_or                                                             31267.0
user_attrs_logical_xor                                                             5667.0
user_attrs_prop_source_covered                                                        NaN
user_attrs_prop_target_covered                                                        NaN
user_attrs_reg_cell_max_corr                                                     0.779721
user_attrs_reg_image_max_corr                                                     0.87574
user_attrs_registration_matrix          [[0.5811535559367804, 0.002494095593971871, -2...
user_attrs_source_sum                                                             29134.0
user_attrs_stack_cell_max_corr                                                   0.779722
user_attrs_stack_image_max_corr                                                  0.875887
user_attrs_target_sum                                                             27733.0
state                                                                            COMPLETE
norm_and                                                                          0.98298
norm_iou                                                                              1.0
norm_corr                                                                             1.0
balanced_score                                                                   0.988653
Name: 69, dtype: object
</pre></div>
</div>
</div>
</div>
<p>We can also check out the registration matrix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">twocan_best_trial</span><span class="p">[</span><span class="s1">&#39;user_attrs_registration_matrix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  0.58,   0.  , -28.28],
       [ -0.  ,   0.58, -22.57]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-result">
<h2>Visualize result<a class="headerlink" href="#visualize-result" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_registration</span><span class="p">(</span><span class="n">sdata</span><span class="p">[</span><span class="s1">&#39;IF&#39;</span><span class="p">],</span> <span class="n">sdata</span><span class="p">[</span><span class="s1">&#39;IMC&#39;</span><span class="p">],</span> <span class="n">twocan_best_trial</span><span class="p">[</span><span class="s1">&#39;user_attrs_registration_matrix&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/11b0ed3b8b8f3e5ecf612e5673a42a0808b91d7c965b2949e8efbf85030bc413.png" src="../_images/11b0ed3b8b8f3e5ecf612e5673a42a0808b91d7c965b2949e8efbf85030bc413.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Caitlin F. Harrigan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>